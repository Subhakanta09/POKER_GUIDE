<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code and Output</title>
    <!-- Highlight.js CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">

    <!-- Highlight.js JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

    <style>
        /* Basic styling */
        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            padding: 20px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 40px;
        }

        .code-section, .output-section {
            margin: 20px 0;
        }

        .code-section h2, .output-section h2 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .code-section pre {
            background-color: #f0f0f0; /* Lighter background */
            color: #333; /* Darker text color */
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            overflow-x: auto;
            font-size: 16px; /* Larger font size for better readability */
            line-height: 1.5;
        }

        .output-section pre {
            background-color: #e8f4e8; /* Slightly different background for output */
            color: #333;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
            font-family: "Courier New", Courier, monospace;
            overflow-x: auto;
            font-size: 16px;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

    </style>
</head>
<body>
    <h1>How to Create a Poker playing Bot</h1>
    <p>We will be using <b>Python</b> and use its library called <code>PyPokerEngine</code></p>
    <h2>Steps to Create a Poker AI Bot</h2>  
    <ol>  
        <li>  
            Create a <code>PokerBot</code> class that is a subclass of   
            <code>PypokerEngine.players.BasePokerPlayer</code>. We will make several bots   
            starting from basic actions to slightly advanced versions.  
        </li>  
        <li>  
            Implement the abstract methods that inherit from the   
            <code>BasePokerPlayer</code> class.  
        </li>  
    </ol>  
    
    <h2>Methods to Implement</h2>  
    <p>The <code>BasePokerPlayer</code> class requires you to implement 6 methods.However, we have made the task easier for you. We have created a class <code> CountingBot</code> which inherits all required methods from <code>BasePokerPlayer</code> This serves as a parent bot.
        You only need to tinker with the <code>declare_action(...)</code> portion.  All you need to do is create a class whose superclass will be this <code>CountingBot</code> and then put in your code in the <code>declare_action</code> method.</p>  
    </p>  
    
    
        <div class="code-section">
            <h2>Install the Library</h2>
            <pre><code class="language-python">
!pip install PyPokerEngine
            </code></pre>
        </div>         
        
        <div class="code-section">
            <h2>Sample Bot 1: Random bot</h2>
            <pre><code class="language-python">
# Random bot
class RBot(CountingBot):
    def __init__(self):
        super().__init__("Pbot")
    def declare_action(self, valid_actions, hole_card, round_state):
        import random
        rand = random.random()
        if rand < 0.5:
            action = next(
                action for action in valid_actions if action["action"] == "call")
        elif rand < 0.8:
            action = next(
                action for action in valid_actions if action["action"] == "raise")
        else:
            action = next(
                action for action in valid_actions if action["action"] == "fold")
        amount = action.get("amount")
        if isinstance(amount, dict):
            amount = amount.get("min", 0)

        self.game_history.append({
            "round_state": round_state,
            "valid_actions": valid_actions,
            "action_taken": (action, amount)
        })

        return action["action"], int(amount or 0)        

        </div>
        <div class="code-section">
            <h2>Sample Bot 2: Cautious Bot</h2>
            <pre><code class="language-python">

class FBot(CountingBot):
    def __init__(self):
        super().__init__("Fbot")

    def declare_action(self, valid_actions, hole_card, round_state):
        current_pot = round_state["pot"]["main"]["amount"]
        if current_pot < 1000:
            action = next(
                action for action in valid_actions if action["action"] == "call")
        else:
            action = next(
                action for action in valid_actions if action["action"] == "fold")
        amount = action.get("amount")
        if isinstance(amount, dict):
            amount = amount.get("min", 0)
        self.game_history.append({
                    "round_state": round_state,
                    "valid_actions": valid_actions,
                    "action_taken": (action, amount)
                })
        return action["action"], int(amount or 0)
            </code></pre>
        </div>         
        
        
<div class="code-section">
    <h2>Start the Gameplay</h2>
    <pre><code class="language-python">
    rb = RBot()
    fb= FBot()
    # Configure and start the game
    config = setup_config(max_round=3, initial_stack=5000, small_blind_amount=5)
    config.register_player(name="RBot", algorithm=rb)
    config.register_player(name="FBot", algorithm=fb)
    game_result = start_poker(config, verbose=1)
        
    </code></pre>
</div>
    
    <div class="output-section">
    <h2>Output</h2>
    <pre>
Pbot's hole cards: ['H6', 'HQ']
Fbot's hole cards: ['SQ', 'C8']
Started the round 1
Street "preflop" started. (community card = [])
"FBot" declared "call:10"
"RBot" declared "raise:15"
"FBot" declared "call:15"
Street "flop" started. (community card = ['SJ', 'DT', 'HK'])
"FBot" declared "call:0"
"RBot" declared "call:0"
Street "turn" started. (community card = ['SJ', 'DT', 'HK', 'D5'])
"FBot" declared "call:0"
"RBot" declared "call:0"
Street "river" started. (community card = ['SJ', 'DT', 'HK', 'D5', 'C2'])
"FBot" declared "call:0"
"RBot" declared "raise:10"
"FBot" declared "call:10"
"['FBot']" won the round 1 (stack = {'RBot': 4975, 'FBot': 5025})
Pbot's hole cards: ['C2', 'SA']
Fbot's hole cards: ['D3', 'H4']
Started the round 2
Street "preflop" started. (community card = [])
"RBot" declared "raise:15"
"FBot" declared "call:15"
Street "flop" started. (community card = ['D8', 'HA', 'S4'])
"RBot" declared "call:0"
"FBot" declared "call:0"
Street "turn" started. (community card = ['D8', 'HA', 'S4', 'D7'])
"RBot" declared "call:0"
"FBot" declared "call:0"
Street "river" started. (community card = ['D8', 'HA', 'S4', 'D7', 'H2'])
"RBot" declared "call:0"
"FBot" declared "call:0"
"['RBot']" won the round 2 (stack = {'RBot': 4990, 'FBot': 5010})
Pbot's hole cards: ['DA', 'CA']
Fbot's hole cards: ['C7', 'C2']
Started the round 3
Street "preflop" started. (community card = [])
"FBot" declared "call:10"
"RBot" declared "call:10"
Street "flop" started. (community card = ['D2', 'D5', 'ST'])
"FBot" declared "call:0"
"RBot" declared "call:0"
Street "turn" started. (community card = ['D2', 'D5', 'ST', 'C6'])
"FBot" declared "call:0"
"RBot" declared "call:0"
Street "river" started. (community card = ['D2', 'D5', 'ST', 'C6', 'CT'])
"FBot" declared "call:0"
"RBot" declared "raise:10"
"FBot" declared "call:10"
"['RBot']" won the round 3 (stack = {'RBot': 5010, 'FBot': 4990})
    </pre>
    </div>

<p> A few things to note from the output:</p>
<ul>
    <li>Cards are written in the string format. For example <b>HA</b> means <b>Ace of Hearts</b>, <b>CT</b> means <b>Ten of Clubs</b></li>
    <li>Sometimes you might see that the output returns <code>"YourBot" declared "raise:-1"</code>.This error occurs whenever the action is not defined or amount is not defined (remains None). We have fixed this error in our bots. However, when you prepare your own bots you must take extra care of it</li>
    <li>Hole cards, community cards are stored as strings in list format. Stack     is being stored as dictionary with key-value pairs as 'Bot Name' : Amount.</li>
</ul>
<h3>You can also play with multiple bots. You just need to register them using <code>config.register_player(name="BotName", algorithm=algo)</code>.</h3>
    
<h2>NOTE</h2>
<p>You must insert the following code snippet in the declare action portion of your code. This is necessary for tracking the moves played by your bot, which in turn is necessary for generating game replays.</p>
<div class="code-section">
        <pre><code class="language-python">
            self.game_history.append({
                "round_state": round_state,
                "valid_actions": valid_actions,
                "action_taken": (action, amount)
            })                
        </code></pre>
    </div>
<p>You can also use this data to make a bot which can track opponent's moves and act accordingly . But you must remember that live tracking of moves is not possible, it can only generate the data of rounds played earlier.</p>



<div class="code-section">
    <h2>Sample Bot 3: Advanced Player</h2>
    <pre><code class="language-python">

class GeneralPlayer(CountingBot):

def __init__(self):
super().__init__("GeneralPlayer")

def declare_action(self, valid_actions, hole_card, round_state):
# Convert hole cards and community cards to PyPokerEngine format
community_cards = round_state["community_card"]

# Estimate hand strength using win rate estimation
num_active_players = self.count_active_players(round_state)
win_rate = estimate_hole_card_win_rate(
    nb_simulation=1000,
    nb_player=num_active_players,
    hole_card=gen_cards(hole_card),
    community_card=gen_cards(community_cards),
)

# Retrieve pot size and bet amount
pot_size = self.get_pot_size(round_state)
bet_amount = self.get_bet_amount(valid_actions)

if win_rate >= 1/num_active_players:  # If win rate is greater than 50% (since 2 players), raise by average of min and max raise
    raise_action = next(
        (a for a in valid_actions if a["action"] == "raise"), None
    )
    if raise_action:
        min_raise = raise_action["amount"]["min"]
        max_raise = raise_action["amount"]["max"]
        raise_amount = (min_raise + max_raise) / 2
        action = {"action": "raise", "amount": raise_amount}
    else:
        # No raise option, fallback to call if available
        action = next(
            (a for a in valid_actions if a["action"] == "call"), None
        ) ## no call option even, then fold
        if not action:
            action = next(
                (a for a in valid_actions if a["action"] == "fold"), None
            )

else :  # If win rate is less than 1/n where n is no. of players, use fold
    action = next((a for a in valid_actions if a["action"] == "fold"), None)
    if not action:
        action = next((a for a in valid_actions if a["action"] == "fold"), None)


# Handle case where no valid action is found
if action is None:
    # If no suitable action is found, default to fold
    action = {'action': 'fold', 'amount': 0}

# Extract amount (handle raise min-max structure)
amount = action.get("amount")
amount = action.get("amount")
if isinstance(amount, dict):
    amount = amount.get("min", 0)  # Get min raise amount
    if amount < 0:              # Check if min amount is negative
        amount = 0              # If negative, set to 0

if amount is None or amount < 0:
    amount = 0  # Default to 0 if amount is invalid or negative

self.game_history.append({
"round_state": round_state,
"valid_actions": valid_actions,
"action_taken": (action, amount)
})


return action["action"], int(amount)

def get_pot_size(self, round_state):
# Assume pot_size starts at 0
pot_size = round_state['pot']['main']['amount']
return pot_size

def get_bet_amount(self, valid_actions):
# Get the current bet amount from valid actions
raise_actions = [a for a in valid_actions if a["action"] == "raise"]
if raise_actions:
    return raise_actions[0]['amount']['min']
else:
    return 0

def count_active_players(self,round_state):
return len(round_state["seats"])
     </code></pre>
</div>
<p>In this code we have used <code>nb_simulation</code> to estimate win rate. The nb_simulations parameter in PyPokerEngine 
typically controls how many Monte Carlo simulations are run for evaluating different actions during decision-making in the poker 
environment. This can help in assessing the best possible move by simulating various scenarios and outcomes based on the current 
game state. A higher number of simulations typically leads to more accurate decision-making. </p>
</div>

<div class="code-section">
<h2>Start the Gameplay</h2>
<pre><code class="language-python">
pb = PBot()
gp = GeneralPlayer()
# Configure and start the game
config = setup_config(max_round=3, initial_stack=5000, small_blind_amount=5)
config.register_player(name="ABot", algorithm=pb)
config.register_player(name="gp", algorithm=gp)
game_result = start_poker(config, verbose=1)
    
</code></pre>
</div>

<div class="output-section">
<h2>Output</h2>
<pre>
Pbot's hole cards: ['CT', 'HJ']
GeneralPlayer's hole cards: ['H7', 'D4']
Started the round 1
Street "preflop" started. (community card = [])
"gp" declared "call:10"
"PBot" declared "fold:0"
"['gp']" won the round 1 (stack = {'PBot': 4990, 'gp': 5010})
Pbot's hole cards: ['HA', 'H6']
GeneralPlayer's hole cards: ['DJ', 'DK']
Started the round 2
Street "preflop" started. (community card = [])
"PBot" declared "call:10"
"gp" declared "raise:2512"
"PBot" declared "fold:0"
"['gp']" won the round 2 (stack = {'PBot': 4980, 'gp': 5020})
Pbot's hole cards: ['S3', 'ST']
GeneralPlayer's hole cards: ['SQ', 'DK']
Started the round 3
Street "preflop" started. (community card = [])
"gp" declared "raise:2517"
"PBot" declared "fold:0"
"['gp']" won the round 3 (stack = {'PBot': 4970, 'gp': 5030})
</pre>
</div>

<h3>For further reference you can see our GitHub Repos. There you can find the code behind <code>CountingBot</code> and few other examples too.</h3>
    <script>hljs.highlightAll();</script>
</body>
</html>
